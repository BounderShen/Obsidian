### 缓存内存组织和操作

#### 缓存内存

1. 高速缓存是基于 SRAM 的小型快速存储器
   在硬件中自动管理
   1. 存储频繁访问的主存块
2. CPU首先在缓存中寻找数据

#### 基本缓存结构

1. 类似二维数组，可缓存量等于`S*E*B`B是块的字节数

#### 缓存读

地址结构：t bits + s bits  + b bits：依次是Tag,set index, 块的偏移量

1. 定位集
2. 检查集合中是否有任何行有匹配的标签
3. 验证是否有效：有效则击中
4. 定位数据的偏移量
5. 没有匹配则旧的踢出和替换

##### 模拟

#### 写

##### 写入命中时怎么办

1. 立即写入内存
2. 回写：延迟写入直到替换行
   1. 需要一个脏位（线路是否与内存不同）

##### 写未命中

1. 写入分配（加载到缓存中，更新缓存中的行）
   1. 如果有更多写入该位置则很好
2. 无写分配（直接写入内存，不加载到缓存中）

##### 典型

1. 直接写入+无写分配（写入到内存，不加载到缓存）
2. 回写+写分配

#### 缓存性能指标

##### 未命中率

1. 1-命中率
2. 3-10% for L1
3. L2可能非常小取决于大小

##### 命中时间

1. 从缓存发送数据到处理器的时间
   1. 决定数据是否存在缓冲中
2. 典型的时间
   1. 4时钟周期 for L1
   2. 10时钟周期 for L2

##### 未命中后果

1. 通常用于50-200时钟周期对于主存，随后更长

#### 让我们思考这些数字

##### 你相信 99% 的命中率是 97% 的两倍吗？

假设：命中时间是 1时钟周期，未命中则是100时钟周期

1. 平均时间对于97%：1 + 0.03 * 100
2. 平均时间对于99%：1 + 0.01 * 100

#### 写缓存友好的代码

1. 集中在循环上
2. 重复引用
3. 使用附近的

### 缓存的性能影响

#### 缓存未命中分析

